<?php

	require '../model/utente.php';
	require '../db/DBConnection.php';
	
	$method = $_SERVER['REQUEST_METHOD'];
	
	if($method == 'GET'){
		//visualizza un utente	
		$username = $_GET['u'];
		$password = md5($_GET['p']);
		$user = getUser($username, $password);
		
	}else if($method=='POST'){
		//inserisci un utente
		$nome = $_POST['n'];
		$cognome = $_POST['c'];
		$company = $_POST['cp'];
		$username = $_POST['u'];
		
		$password = $_POST['p'];
		$rpass = $_POST['rp'];
		
		if($password != $rpass){
			return ;
		}
		
		$password = md5($password);
		
		$user = new Utente($nome, $cognome, $company, $username, $password);
		addUser($user);
	}
	
	//aggiunge l'utente al database
	function addUser($user){
		$db = DBConnection::getConnection();
		
		$query = "SELECT * FROM Utente WHERE username='".$user->getUsername()."'";
		$user = null;
		
		if(!$result = $db->query($query)){
			die('There was an error running the query [' . $db->error . ']');
		}
		
		if($result->num_rows){
			die("Utente già esistente");
		}else{
			$query = "INSERT INTO Utente(Nome, Cognome, Compagnia, username, password) VALUES ('" . $user->getUsername() . "','".$user->getCognome()."','".$user->getCompany()."', '".$user->getUsername()."','".$user->getPassword()."')";
			if(!$result = $db->query($query)){
				die('There was an error running the query [' . $db->error . ']');
			}else
				die("utente aggiunto correttamente");
		}
		
	}
	
	function getUser($username, $password){
		$db = DBConnection::getConnection();
		$query = "SELECT * FROM Utente WHERE username='$username' AND password='$password'";
		$user = null;
		
		if(!$result = $db->query($sql)){
			die('There was an error running the query [' . $db->error . ']');
		}
		
		if($result->num_rows){
			//$user = new Utente($nome, $cognome, $company);
			
		}else{
			//utente inesistente
		}
		
		
	}

?>
	
