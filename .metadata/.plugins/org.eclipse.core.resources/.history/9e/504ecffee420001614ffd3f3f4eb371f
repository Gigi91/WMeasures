<?php

	require 'DBConnection.php';
	
	class MisuraDao{
		//aggiunge il sensore al database
		public function aggiornaMisura($misura){
			$db = DBConnection::getConnection();

			$query = "INSERT INTO Misura(DescSensore,IDUtente,data,ora,valore) values ('".$misura->descSensore."','".
					$misura->username."',DATE('".$misura->date."'),TIME('".$misura->time."'),".$misura->value.")";
			//die($query);
			if(!$result = $db->query($query)){
				die('There was an error running the query [' . $db->error . ']');
				return false;
			}
			return true;
			
			
		
		}
		
		public function ottieniMisure($username, $start, $end, $sensorList){
			$db = DBConnection::getConnection();
			$sensori = join(',',$sensorList);
			$query = "SELECT DescSensore, valore FROM Misura WHERE IDUtente='".$username."' AND DescSensore IN ($sensori) and data BETWEEN DATE('$start')  AND DATE('$end');";
			
			if(!$result = $db->query($query)){
				die('There was an error running the query [' . $db->error . ']');
				return false;
			}

			if($result->num_rows){
				$list = array();
				while($row = $result->fetch_assoc()){
					$desc = $row['DescSensore'];
					$val = $row['valore'];
					
					if(!isset($list[$desc])) {
				     $list[$desc] = array();
				 	}
				 	$list[$desc][] = $val;
				}
				
				return $list;
			}else{
				return false;
			}
			
			
		}
		
	}